<!DOCTYPE html>
<html>
<head>
<title>千寻游戏</title>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<link type="text/css" rel="stylesheet" href="/styles/common.css?t=20150707" />
<link type="text/css" rel="stylesheet" href="/styles/default.css?t=20150707" />
<link type="text/css" rel="stylesheet" href="/styles/jquery_dialog_x.css?t=20150707" />
<script src="http://libs.baidu.com/jquery/1.10.2/jquery.min.js"></script>
<script type="text/javascript" src="/scripts/jquery_dialog_x.js"></script>
<script type="text/javascript" src="/scripts/global.js"></script>
<script type="text/javascript" src="/scripts/qx.js"></script>
<script type="text/javascript" src="/scripts/startMove.js"></script>
<script type="text/javascript" src="/scripts/jscroll.js"></script>
<script type="text/javascript" src="/scripts/sha512.js"></script>
</head>
<body>
<input id="chat" type="text" />
<div id="msg">

</div>

<script type="text/javascript">
$(document).ready(function(){
	var baseUrl = "/poll/";
	var uuid = null;
	$.get(baseUrl,{"token":"long-poll"},function(d1){
		uuid = d1;
		if ( uuid != null) {
			//long-poll
			longPoll();
		}
	});
	$("#chat").keydown(function (e) {
        if (e.keyCode === 13 && uuid != null) {
			$.get(baseUrl,{"uuid":uuid,"cmd":"login.chat","group":"g123","msg":$(this).val()},function(d2){
				$("#msg").html(d2+"<br/>"+$("#msg").html());//document.body.innerHTML+
			});
		}
		
		if(e.ctrlKey && e.keyCode == 13){
			$("#msg").html("");
		}
	});

function longPoll(){
	$.ajax({
		method: "GET",
		dataType:"json",
		url: baseUrl,
		data: {"token":"long-poll","uuid":uuid,"cmd":"login.poll","group":"g123"},
		error:function(type ,status){
			longPoll();
			},
		success:function(d2) {
			for(var i=0;i<d2.length;i++){
				$("#msg").html(d2[i]+"<br/>"+$("#msg").html());
			}
			longPoll();
			}
		});
//	$.get(baseUrl,{"token":"long-poll","uuid":uuid,"cmd":"login.poll","group":"g123"},function(d2){
//		$("#msg").html(d2+"<br/>"+$("#msg").html());
//		longPoll();
//	});
}
});
</script>
</body>
</html>